{% extends "base.html" %}
{% load attendance_extras %}

{% block content %}
<div class="container mt-4">

<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-semibold mb-0">
        üìù Attendance
        <small class="text-muted">({{ today }})</small>
    </h4>

    <a href="{% url 'teacher_dashboard' %}" class="btn btn-sm btn-outline-secondary">
        ‚¨Ö Back to Dashboard
    </a>
</div>

<!-- ‚úÖ ATTENDANCE COMPLETED BADGE -->
{% if attendance_locked %}
    <span class="badge bg-success mb-3 d-inline-block">
        Attendance Completed & Locked
    </span>
{% endif %}

<form method="post">
    {% csrf_token %}

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 60px;">#</th>
                        <th>STUDENTS</th>
                        <th>CLASS</th>
                        <th style="width: 200px;">Status</th>
                    </tr>
                </thead>
                <tbody>

                {% for student in students %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ student.full_name }}</td>
                        <td>{{ student.class_name }}</td>
                        <td>
                            <select name="status_{{ student.id }}"
                                    class="form-select form-select-sm"
                                    {% if attendance_locked %}disabled{% endif %}>

                                <option value="">---</option>

                                <option value="Present"
                                    {% if attendance_map|get_item:student.id == "Present" %}
                                        selected
                                    {% endif %}>
                                    Present
                                </option>

                                <option value="Absent"
                                    {% if attendance_map|get_item:student.id == "Absent" %}
                                        selected
                                    {% endif %}>
                                    Absent
                                </option>
                            </select>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">
                            No students assigned to you
                        </td>
                    </tr>
                {% endfor %}

                </tbody>
            </table>
        </div>
    </div>

    <!-- ‚úÖ BUTTONS -->
    <div class="mt-3">
        {% if not attendance_locked %}
            <button class="btn btn-success">
                Save Attendance
            </button>
        {% else %}
            <button class="btn btn-secondary" disabled>
                üîí Attendance Locked
            </button>
        {% endif %}
    </div>

</form>
</div>
{% endblock %}
