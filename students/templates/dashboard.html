{% extends "base.html" %}
{% load static %}
{% block content %}
<style>


.cb-hero {
    height: 80vh;
    background: linear-gradient(
        rgba(0,0,0,0.75),
        rgba(0,0,0,0.75)
    ),
    url("{% static 'images/dashimage.jpg' %}") center/cover no-repeat;

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #fff;
    box-shadow: inset 0 -40px 60px rgba(0,0,0,0.4);
}

.hero-actions {
    margin-top: 70px;
}



/* BRAND TEXT ANIMATION */
.cb-hero h1 {
    font-size: 3.2rem;
    font-weight: 700;
    letter-spacing: 2px;
    animation: floatLR 18s ease-in-out infinite;
    position: relative;
}


.cb-hero p,
.cb-hero small {
    animation: fadeUp 1.6s ease forwards;
    opacity: 0;
}

.cb-hero small {
    display: block;
    margin-top: 10px;
    font-size: 0.85rem;
    letter-spacing: 1px;
    color: #cbd5e1;
}

/* FADE UP EFFECT */
@keyframes fadeUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}


@keyframes slideInOnce {
    from {
        opacity: 0;
        transform: translateX(-40px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* HERO CENTER */
.hero-content {
    position: relative;
    z-index: 2;
}

/* DASHBOARD AREA */
.dashboard-bg {
  min-height: 100vh;
  background: url("{% static 'images/abstract.jpg' %}")center/cover no-repeat;
    
}

.card {
    border-radius: 15px;
}

.chart-card {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart-card canvas {
    height: 320px !important;
}


.dashboard-card {
    border-radius: 10px;
    background: #ffffff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    transition: all 0.25s ease;
    padding: 12px 15px;
}

.dashboard-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
}
.dashboard-card h6 {
    font-size: 0.8rem;
    letter-spacing: 0.8px;
    text-transform: uppercase;
}

.dashboard-card h3 {
    font-size: 1.8rem;
}

.chart-card h5 {
    font-size: 1rem;
    margin-bottom: 15px;
    color: #0f172a;
}

.table thead th {
    font-size: 0.85rem;
    color: #334155;
    font-weight: 600;
}


</style>


<section class="cb-hero {% if not request.user.is_superuser %}cb-hero-full{% endif %}">
      
     <div>
        <h1>COLOR BLACK 19</h1>
        <p>Smart School Fees Management System</p>
        <small>Automated ‚Ä¢ Secure ‚Ä¢ M-Pesa Integrated</small>
    </div>


</section>





 <section class="dashboard-bg">

     <div class="container py-4">

     <div class="row g-4 mb-4">

       <div class="col-md-3 col-sm-6">
          <div class="card dashboard-card">
            <h6>Total Students</h6>
            <h3>{{ total_students }}</h3>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card dashboard-card">
            <h6>Total Payments</h6>
            <h3>{{ total_payments }}</h3>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card dashboard-card">
            <h6>Amount Paid</h6>
            <h3>KES {{ total_amount_paid }}</h3>
        </div>
    </div>

    <div class="col-md-3 col-sm-6">
        <div class="card dashboard-card">
            <h6>Expected Fees</h6>
            <h3>KES {{ total_fee_expected }}</h3>
        </div>
    </div>

</div>


<div class="row g-4">

    <div class="col-md-6">
        <div class="card dashboard-card p-3 chart-card">
            <h5 class="fw-bold">Payments Per Class</h5>
            <canvas id="barChart"></canvas>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card dashboard-card p-3 chart-card">
            <h5 class="fw-bold">Paid vs Balance</h5>
            <canvas id="pieChart"></canvas>
        </div>
    </div>

</div>

<!-- BALANCES -->
<div class="card shadow mt-4 p-3">
    <h5 class="fw-bold">‚ö†Ô∏è Students With Balance</h5>

    {% if students_with_balance %}
        <ul class="list-group">
            {% for s in students_with_balance %}
                <li class="list-group-item d-flex justify-content-between">
                    {{ s.name }}
                    <span class="badge bg-danger">KES {{ s.balance }}</span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-success fw-semibold">üéâ All students have cleared fees</p>

    {% endif %}
</div>

<!-- RECENT PAYMENTS -->
<div class="card shadow mt-4 p-3">
    

    <h5 class="fw-bold">Recent Payments</h5>
    <table class="table table-striped">
        <thead class="bg-light">

        <tr>
            <th>Student</th>
            <th>Amount</th>
            <th>Method</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody>
        {% for p in recent_payments %}
            <tr>
                <td>{{ p.student.full_name }}</td>
                <td>KES {{ p.amount_paid }}</td>
                <td>{{ p.method }}</td>
                <td>{{ p.date_paid }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="4" class="text-center text-muted">
                    No payments yet
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

</div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
        labels: {{ classes|safe }},
        datasets: [{
            label: 'Payments',
            data: {{ amount_per_class|safe }},
            backgroundColor: 'rgba(54,162,235,0.8)'
        }]
    }
});

new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
        labels: ["Paid", "Remaining"],
        datasets: [{
            data: [{{ total_amount_paid }}, {{ remaining_balance }}],
            backgroundColor: ['#28a745','#dc3545']
        }]
    }
});


window.addEventListener("scroll", function () {
    const hero = document.querySelector(".cb-hero");
    let scroll = window.scrollY;
    hero.style.backgroundPositionY = scroll * 0.4 + "px";
});


</script>
    <!-- üîµ CHAT ICON (ADMIN + TEACHER ONLY) -->
{% if can_see_chat %}
<a href="{% url 'chat_home' %}" class="chat-icon">
    üí¨
    {% if unread_count > 0 %}
        <span class="badge">{{ unread_count }}</span>
    {% endif %}
</a>
{% endif %}

{% endblock %}
